<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Administrador - Juego Educativo</title>

  <!-- CSS del login -->
  <link rel="stylesheet" th:href="@{/SRC.2/CSS/login.css}" />
  <!-- CSS del navbar -->
  <link rel="stylesheet" th:href="@{/SRC.2/CSS/navbar.css}" />
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* Estilos específicos para el registro */
    .registro-form {
      background: rgba(40, 40, 40, 0.95);
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
      border: 2px solid #28a745;
      backdrop-filter: blur(10px);
      max-width: 500px;
      width: 100%;
    }

    .registro-form h2 {
      color: #28a745;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      color: #28a745;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
    }

    .form-control {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #333333;
      border-radius: 8px;
      padding: 12px 15px;
      color: #ffffff;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: #28a745;
      box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      color: #ffffff;
    }

    .form-control::placeholder {
      color: #999999;
    }

    .btn-registro {
      background: linear-gradient(45deg, #28a745, #20c997);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-registro:hover {
      background: linear-gradient(45deg, #218838, #1e7e34);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
      color: white;
    }

    .btn-registro:active {
      transform: translateY(0);
    }

    .acciones {
      margin-top: 25px;
      text-align: center;
    }

    .acciones a {
      color: #28a745;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.3s ease;
      font-weight: 500;
      margin: 0 15px;
    }

    .acciones a:hover {
      color: #20c997;
      text-decoration: underline;
    }

    /* Campos en fila */
    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Indicadores de validación */
    .form-control.valid {
      border-color: #28a745;
      box-shadow: 0 0 0 0.1rem rgba(40, 167, 69, 0.15);
    }

    .form-control.invalid {
      border-color: #dc3545;
      box-shadow: 0 0 0 0.1rem rgba(220, 53, 69, 0.15);
    }

    /* Tooltip para requisitos de contraseña */
    .password-tooltip {
      background: rgba(40, 167, 69, 0.1);
      border: 1px solid #28a745;
      border-radius: 8px;
      padding: 10px;
      margin-top: 8px;
      font-size: 12px;
      color: #cccccc;
      display: none;
    }

    .password-tooltip.show {
      display: block;
    }

    .password-tooltip ul {
      margin: 0;
      padding-left: 20px;
    }

    .password-tooltip li {
      margin-bottom: 3px;
    }

    .password-tooltip li.valid {
      color: #28a745;
    }

    @media (max-width: 768px) {
      .login-container {
        flex-direction: column;
      }
      
      .login-left {
        height: 200px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .registro-form {
        padding: 30px 20px;
        margin: 20px;
      }
    }
  </style>

  <script>
    function soloLetras(e) {
      const key = e.key;
      if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]$/.test(key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(key)) {
        e.preventDefault();
      }
    }

    function soloNumeros(e) {
      const key = e.key;
      if (!/^\d$/.test(key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(key)) {
        e.preventDefault();
      }
    }

    function limitarTelefono(input) {
      input.value = input.value.replace(/\D/g, '').slice(0, 10);
      validarCampo(input);
    }

    function validarCampo(input) {
      const valor = input.value.trim();
      
      switch(input.type) {
        case 'text':
          if (input.name.includes('tel') || input.id.includes('tel')) {
            input.classList.toggle('valid', valor.length === 10);
            input.classList.toggle('invalid', valor.length > 0 && valor.length !== 10);
          } else {
            input.classList.toggle('valid', valor.length >= 2);
            input.classList.toggle('invalid', valor.length > 0 && valor.length < 2);
          }
          break;
        case 'email':
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          input.classList.toggle('valid', emailRegex.test(valor));
          input.classList.toggle('invalid', valor.length > 0 && !emailRegex.test(valor));
          break;
        case 'password':
          const passwordValid = valor.length >= 8;
          input.classList.toggle('valid', passwordValid);
          input.classList.toggle('invalid', valor.length > 0 && !passwordValid);
          break;
      }
    }

    function mostrarRequisitosPassword() {
      document.getElementById('passwordTooltip').classList.add('show');
    }

    function ocultarRequisitosPassword() {
      setTimeout(() => {
        if (document.activeElement.id !== 'password') {
          document.getElementById('passwordTooltip').classList.remove('show');
        }
      }, 200);
    }

    function validarPasswordEnTiempoReal(input) {
      const valor = input.value;
      const tooltip = document.getElementById('passwordTooltip');
      const requisitos = tooltip.querySelectorAll('li');
      
      // Validar cada requisito
      const tieneMinimo8 = valor.length >= 8;
      const tieneMayuscula = /[A-Z]/.test(valor);
      const tieneMinuscula = /[a-z]/.test(valor);
      const tieneNumero = /\d/.test(valor);
      const tieneEspecial = /[!@#$%^&*(),.?":{}|<>]/.test(valor);
      
      requisitos[0].classList.toggle('valid', tieneMinimo8);
      requisitos[1].classList.toggle('valid', tieneMayuscula);
      requisitos[2].classList.toggle('valid', tieneMinuscula);
      requisitos[3].classList.toggle('valid', tieneNumero);
      requisitos[4].classList.toggle('valid', tieneEspecial);
      
      const esValida = tieneMinimo8 && tieneMayuscula && tieneMinuscula && tieneNumero && tieneEspecial;
      input.classList.toggle('valid', esValida);
      input.classList.toggle('invalid', valor.length > 0 && !esValida);
    }
  </script>
</head>

<body th:style="'background: url(' + @{/SRC.2/IMG/fondo.jpg} + ') no-repeat center/cover;padding-top:0px'">
<div th:replace="~{plantilla/navbar :: navbar}"></div>

<!-- Mensajes de alerta -->
<div th:if="${success}" class="alert alert-success text-center">
  <i class="fas fa-check-circle me-2"></i>
  <span th:text="${success}"></span>
</div>

<div th:if="${error}" class="alert alert-danger text-center">
  <i class="fas fa-exclamation-circle me-2"></i>
  <span th:text="${error}"></span>
</div>

<!-- Formulario de registro -->
<div class="login-container">
  <div class="login-left">
    <div class="overlay">
      <h1>¡Bienvenido Admin!</h1>
      <p>Registra un nuevo administrador para el sistema Shenmi.</p>
    </div>
  </div>
  
  <div class="login-right">
    <form th:action="@{/admin/guardar}" th:object="${usuario}" method="post" class="registro-form">
      <h2>
        <i class="fas fa-user-shield me-2"></i>
        REGISTRO DE ADMINISTRADOR
      </h2>

      <!-- Nombre y Apellido en fila -->
      <div class="form-row">
        <div class="form-group">
          <label for="nombre">
            <i class="fas fa-user me-1"></i>Nombre
          </label>
          <input type="text" 
                 id="nombre"
                 th:field="*{nombreUsuario}" 
                 onkeypress="soloLetras(event)"
                 onblur="validarCampo(this)"
                 class="form-control"
                 placeholder="Miguel" 
                 required>
        </div>
        <div class="form-group">
          <label for="apellido">
            <i class="fas fa-user me-1"></i>Apellido
          </label>
          <input type="text" 
                 id="apellido"
                 th:field="*{apellidoUsuario}" 
                 onkeypress="soloLetras(event)"
                 onblur="validarCampo(this)"
                 class="form-control"
                 placeholder="Arévalo" 
                 required>
        </div>
      </div>

      <!-- Teléfono -->
      <div class="form-group">
        <label for="telefono">
          <i class="fas fa-phone me-1"></i>Teléfono
        </label>
        <input type="text" 
               id="telefono"
               th:field="*{telUsuario}" 
               onkeypress="soloNumeros(event)" 
               oninput="limitarTelefono(this)"
               maxlength="10" 
               pattern="\d{10}" 
               title="Debe contener exactamente 10 números"
               class="form-control"
               placeholder="3001234567" 
               required>
      </div>

      <!-- Correo -->
      <div class="form-group">
        <label for="correo">
          <i class="fas fa-envelope me-1"></i>Correo Electrónico
        </label>
        <input type="email" 
               id="correo"
               th:field="*{correoUsuario}"
               onblur="validarCampo(this)"
               class="form-control"
               placeholder="admin@shenmi.com" 
               required>
      </div>

      <!-- Contraseña -->
      <div class="form-group">
        <label for="password">
          <i class="fas fa-lock me-1"></i>Contraseña
        </label>
        <input type="password" 
               id="password"
               th:field="*{contrasena}"
               onfocus="mostrarRequisitosPassword()"
               onblur="ocultarRequisitosPassword()"
               oninput="validarPasswordEnTiempoReal(this)"
               class="form-control"
               placeholder="Contraseña segura" 
               required>
        
        <div id="passwordTooltip" class="password-tooltip">
          <strong>Requisitos de la contraseña:</strong>
          <ul>
            <li>Mínimo 8 caracteres</li>
            <li>Al menos una letra mayúscula</li>
            <li>Al menos una letra minúscula</li>
            <li>Al menos un número</li>
            <li>Al menos un carácter especial (@, #, $, etc.)</li>
          </ul>
        </div>
      </div>

      <!-- Botón -->
      <button type="submit" class="btn-registro">
        <i class="fas fa-user-plus me-2"></i>
        Registrar Administrador
      </button>
      
      <div class="acciones">
        <a href="javascript:history.back()">
          <i class="fas fa-arrow-left me-1"></i>
          Volver atrás
        </a>
        <a th:href="@{/admin}">
          <i class="fas fa-users-cog me-1"></i>
          Ver administradores
        </a>
      </div>
    </form>
  </div>
</div>

<!-- Scripts del navbar -->
<script>
  document.getElementById('bmenu')?.addEventListener('click', () => {
    document.getElementById('links').classList.toggle('show');
  });

  document.addEventListener('DOMContentLoaded', function() {
    // Agregar efecto de loading al botón cuando se envía el formulario
    const form = document.querySelector('form');
    const submitBtn = document.querySelector('.btn-registro');
    
    if (form && submitBtn) {
      form.addEventListener('submit', function(e) {
        // Validar que todos los campos requeridos estén llenos
        const campos = form.querySelectorAll('input[required]');
        let todosValidos = true;
        
        campos.forEach(campo => {
          if (!campo.value.trim()) {
            campo.classList.add('invalid');
            todosValidos = false;
          }
        });
        
        if (!todosValidos) {
          e.preventDefault();
          alert('Por favor, completa todos los campos requeridos.');
          return;
        }
        
        const originalContent = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Registrando...';
        submitBtn.disabled = true;
        
        // En caso de error, restaurar el botón después de un tiempo
        setTimeout(() => {
          if (submitBtn.disabled) {
            submitBtn.innerHTML = originalContent;
            submitBtn.disabled = false;
          }
        }, 10000);
      });
    }
  });
</script>
</body>
</html>